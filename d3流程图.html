<!DOCTYPE html>

<meta charset="utf-8" />
<title>Dagre D3 Demo: Arrows</title>

<script src="./js/d3.v5.min.js" charset="utf-8"></script>
<script src="./js/dagre-d3.min.js"></script>

<style id="css">
  .clusters rect {
    fill: #00ffd0;
    stroke: #999;
    stroke-width: 1.5px;
  }

  text {
    font-weight: 300;
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serf;
    font-size: 14px;
    fill: #000;
  }

  .node rect {
    stroke: #fff;
    fill: #ea7132;
    stroke-width: 1.5px;
  }

  .edgePath path {
    stroke: #333;
    stroke-width: 1.5px;
  }
</style>
<div>
  <svg width="100%" height="900"></svg>
</div>

<script>
  var data = {
    nodes: [
          {
            id: 0,
            nodeName: '节点0',
          },
          {
            id: 1,
            nodeName: '节点1',
          },
          {
            id: 2,
            nodeName: '节点2',
          },
          {
            id: 3,
            nodeName: '节点3',
          },
          {
            id: 4,
            nodeName: '节点4',
          },
          {
            id: 5,
            nodeName: '节点5',
          },
          {
            id: 6,
            nodeName: '节点6',
          },
          {
            id: 7,
            nodeName: '节点7',
          },
          {
            id: 8,
            nodeName: '节点8',
          },
          {
            id: 9,
            nodeName: '节点9',
          },
          {
            id: 10,
            nodeName: '节点10',
          },
          {
            id: 11,
            nodeName: '节点11',
          }, 
          {
            id: 12,
            nodeName: '节点12',
          },         
        ],
        edges: [
          {
            start: 1,
            end: 0,
          },
          {
            start: 2,
            end: 1,
          },
          {
            start: 3,
            end: 2,
          },
          {
            start: 4,
            end: 3,
          },
          {
            start: 5,
            end: 3,
          },
          {
            start: 6,
            end: 5,
          },
          {
            start: 7,
            end: 2,
          },
          {
            start: 8,
            end: 7,
          },
          {
            start: 9,
            end: 1,
          },
          {
            start: 9,
            end: 10,
          },
          {
            start: 11,
            end: 10,
          },
          {
            start: 12,
            end: 11,
          },          
        ]
  };
  // 构造d3对象
  var g = new dagreD3.graphlib.Graph({ compound: true })
    .setGraph({})
    .setDefaultEdgeLabel(function () {
      return {};
    });
  // 画节点
  function drawNode() {
    for (let i in data.nodes) {
      //画点
      let el = data.nodes[i];

      g.setNode(el.id, {
        label: el.nodeName,
      });
    }
  }
  // 连线
  function drawEdg() {
    for (let i in data.edges) {
      // 画连线
      let el = data.edges[i];
      g.setEdge(el.start, el.end, {
        arrowhead: "vee",
      });
    }
  }

  drawNode();
  drawEdg();

  // 渲染画布
  var render = new dagreD3.render();
  var svg = d3.select("svg"),
    svgGroup = svg.append("g");
  // 设置缩放
  var zoom = d3.zoom().on("zoom", function () {
    svgGroup.attr("transform", d3.event.transform);
  });
  svg.call(zoom);
  // 设置从左到右的布局]
  g.setGraph({
    nodesep: 40,
    ranksep: 20,
    rankdir: "LR",
    marginx: 10,
    marginy: 10,
  });
  //渲染到画布上
  render(d3.select("svg g"), g);
</script>
